Ajax轮询



## 一、什么是轮询

　　轮询（Polling）是一种CPU决策如何提供周边设备服务的方式，又称“程控输出入”（Programmed I/O）。轮询法的概念是，由CPU定时发出询问，依序询问每一个周边设备是否需要其服务，有即给予服务，服务结束后再问下一个周边，接着不断周而复始。

　　在WEB上来说就是客户端一直向服务端发起请求，服务端返回数据，不论返回什么都会再次向服务端发送请求。

　　那么这样的一种技术优点显而易见，实现容易；但是缺点也非常明显，效率很低。而且当访问量大时，服务器的压力是非常大的。

## 二、应用场景

　　在前一段时间我做项目的时候有这样的一个业务需求，当我在操作浏览器时，我点击A页面的一个按钮，要弹出一个空白的B页面。我在A上进行特定操作时，B页面要跳转到A页面的选中的数据的URL所对应的页面。

　　弹空页面很好说，因为后端用的Django框架，render一个界面出来就行，前端用window.open('/new_window/','_blank')就ok了。B页面跳转也好说，一个iframe标签，然后修改它的src属性就可以了。问题是我操作A界面B怎么能监听到呢……

　　公司没有专业的前端，都是我硬着头皮去写。和同事商量了几种方案，比如让做C#开发的同事做一个程序帮忙监听，或者是用python直接操作文件句柄。但是这两个方案的开销都有点大，万般无奈之下我们只能在前端上找方法（忍不住吐槽一下，我老大竟然让我们用while true发ajax，觉得有道理的自己尝试……）最后选定了轮询的方式（因为是内部系统，用户量实在是小，如果用户量大自行了解**长轮询**和**websocket**）。

## 三、代码实现

‘’‘

<script>
    setInterval("test()",500);
    function test() {
        $.ajax({
            url: '/new_window_url/',
            async:true,
            type: 'get',
            success: function (data) {
                var new_url =  $('#new_iframe').attr('src');
                if (new_url !== data){
                    $('#new_iframe').attr('src', data);
                }
            }
        })
    }
</script>

’‘’

setInterval按照固定的周期（单位是毫秒）去执行一个函数或者计算表达式。在Ajax请求里有一个参数非常重要，async为True时代表了是异步请求，这样不会锁死浏览器，但是为False时代表了同步请求会锁住浏览器。